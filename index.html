<!doctype html>
<html lang="zh-TW">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>iPhone Safari æ¢ç¢¼æƒæ</title>
<style>
body{font-family:-apple-system,"Noto Sans TC",Arial;background:#f6f7f9;margin:0;padding:20px}
h2{margin:0 0 10px}
button{padding:10px 14px;border-radius:10px;border:0;background:#0a84ff;color:#fff;font-size:15px}
.videoWrap{margin-top:12px;border-radius:12px;overflow:hidden;background:#000;aspect-ratio:4/3}
video{width:100%;height:100%;object-fit:cover}
.result{margin-top:12px;font-size:16px;font-weight:600}
.small{font-size:13px;color:#555;margin-top:6px}
</style>
</head>

<body>
<h2>ğŸ“· æ¢ç¢¼æƒæï¼ˆiPhone Safari ä¿®æ­£ç‰ˆï¼‰</h2>
<button id="startBtn">é–‹å§‹æƒæ</button>

<div class="videoWrap">
  <video id="video" playsinline muted></video>
</div>

<div class="result" id="result">å°šæœªæƒæ</div>
<div class="small" id="status">ç‹€æ…‹ï¼šç­‰å¾…é–‹å§‹</div>

<script src="https://cdn.jsdelivr.net/npm/@zxing/library@0.20.0/umd/index.min.js"></script>
<script>
const video = document.getElementById("video");
const startBtn = document.getElementById("startBtn");
const resultEl = document.getElementById("result");
const statusEl = document.getElementById("status");

const codeReader = new ZXing.BrowserMultiFormatReader();

startBtn.addEventListener("click", () => {
  statusEl.textContent = "ç‹€æ…‹ï¼šè¦æ±‚ç›¸æ©Ÿæ¬Šé™ä¸­â€¦";

  // âš ï¸ é—œéµï¼šæ‰€æœ‰ç›¸æ©Ÿå•Ÿå‹•éƒ½åœ¨ click åŒæ­¥æµç¨‹å…§
  navigator.mediaDevices.getUserMedia({
    video: { facingMode: { ideal: "environment" } },
    audio: false
  }).then(stream => {
    video.srcObject = stream;

    // âš ï¸ Safari é—œéµé»ï¼šplay ä¸èƒ½è¢« await
    video.play();

    statusEl.textContent = "ç‹€æ…‹ï¼šç›¸æ©Ÿå·²å•Ÿå‹•ï¼Œæƒæä¸­â€¦";

    codeReader.decodeFromVideoElement(video, (result, err) => {
      if (result) {
        resultEl.textContent = "å•†å“ç·¨è™Ÿï¼š" + result.getText();
      }
    });
  }).catch(err => {
    console.error(err);
    statusEl.textContent = "ç‹€æ…‹ï¼šç›¸æ©Ÿå•Ÿå‹•å¤±æ•—ï¼ˆè«‹ç¢ºèªæ¬Šé™ï¼‰";
  });
});
</script>
</body>
</html>
