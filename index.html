<!doctype html>
<html lang="zh-TW">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>æ‹ç…§è¾¨è­˜å•†å“æ¢ç¢¼</title>

<style>
body{
  font-family:-apple-system,"Noto Sans TC",Arial;
  background:#f6f7f9;
  margin:0;
  padding:20px;
}
h2{margin:0 0 10px}
.card{
  background:#fff;
  border-radius:14px;
  padding:16px;
  box-shadow:0 6px 18px rgba(0,0,0,.08);
  max-width:420px;
  margin:auto;
}
button{
  width:100%;
  padding:14px;
  font-size:16px;
  border-radius:12px;
  border:0;
  background:#0a84ff;
  color:#fff;
}
.preview{
  margin-top:12px;
  border-radius:12px;
  overflow:hidden;
  background:#000;
}
img{
  width:100%;
  display:block;
}
.result{
  margin-top:14px;
  font-size:18px;
  font-weight:700;
}
.status{
  margin-top:6px;
  font-size:13px;
  color:#555;
}
input[type=file]{display:none}
</style>
</head>

<body>

<div class="card">
  <h2>ğŸ“¸ æ‹ç…§æƒæå•†å“æ¢ç¢¼</h2>

  <button onclick="openCamera()">æ‹ç…§æƒæ</button>

  <input
    id="fileInput"
    type="file"
    accept="image/*"
    capture="environment"
  />

  <div class="preview" id="preview"></div>

  <div class="result" id="result">å°šæœªè¾¨è­˜</div>
  <div class="status" id="status">ç‹€æ…‹ï¼šç­‰å¾…æ‹ç…§</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@zxing/library@0.20.0/umd/index.min.js"></script>

<script>
const fileInput = document.getElementById("fileInput");
const preview = document.getElementById("preview");
const resultEl = document.getElementById("result");
const statusEl = document.getElementById("status");

const reader = new ZXing.BrowserMultiFormatReader();

function openCamera(){
  fileInput.click();
}

fileInput.addEventListener("change", async () => {
  const file = fileInput.files[0];
  if(!file) return;

  statusEl.textContent = "ç‹€æ…‹ï¼šç…§ç‰‡è®€å–ä¸­â€¦";
  resultEl.textContent = "è¾¨è­˜ä¸­â€¦";

  // é¡¯ç¤ºç…§ç‰‡
  const img = document.createElement("img");
  img.src = URL.createObjectURL(file);
  preview.innerHTML = "";
  preview.appendChild(img);

  try{
    const image = new Image();
    image.src = img.src;

    image.onload = async () => {
      try{
        const result = await reader.decodeFromImageElement(image);
        resultEl.textContent = "å•†å“ç·¨è™Ÿï¼š" + result.getText();
        statusEl.textContent = "ç‹€æ…‹ï¼šè¾¨è­˜æˆåŠŸ";
      }catch(e){
        resultEl.textContent = "âŒ ç„¡æ³•è¾¨è­˜æ¢ç¢¼";
        statusEl.textContent = "ç‹€æ…‹ï¼šè«‹é‡æ–°æ‹ç…§ï¼Œç¢ºä¿æ¢ç¢¼æ¸…æ¥š";
      }
    };

  }catch(err){
    console.error(err);
    resultEl.textContent = "âŒ ç™¼ç”ŸéŒ¯èª¤";
    statusEl.textContent = "ç‹€æ…‹ï¼šè¾¨è­˜å¤±æ•—";
  }
});
</script>

</body>
</html>
